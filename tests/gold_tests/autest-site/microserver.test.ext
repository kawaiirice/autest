
from ports import bind_unused_port


def foo(self,val):
    print(self.Name,val)

def MakeOriginServer(obj, name,public_ip=False):
    server_path= os.path.join(obj.Variables.AtsTestToolsDir,'microServer/uWServer.py')
    data_dir = os.path.join(obj.RunDirectory, name)
    sock,port = bind_unused_port()
    command = "python3 {0} --data-dir {1} --port {2} --public {3}".format(server_path, data_dir, port, public_ip)
    
    # create process
    p = obj.Processes.Process(name, command)
    p.Setup.MakeDir(data_dir)
    p.Variables.Port = port
    p.Variables.DataDir = data_dir

    AddMethodToInstance(p,foo,name="Bob")

    return p

AddTestRunSet(MakeOriginServer,name="MakeOriginServer")
AddTestRunSet(MakeOriginServer,name="MakeOrigin")
